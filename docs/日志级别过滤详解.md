# æ—¥å¿—çº§åˆ«è¿‡æ»¤è¯¦è§£

## enabled æ–¹æ³•è§£æ

```rust
fn enabled(&self, metadata: &Metadata) -> bool {
    metadata.level() <= self.level
}
```

è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ï¼š**åˆ¤æ–­æŸæ¡æ—¥å¿—æ˜¯å¦åº”è¯¥è¢«è®°å½•**ã€‚

## æ—¥å¿—çº§åˆ«ä½“ç³»

### æ—¥å¿—çº§åˆ«ä»é«˜åˆ°ä½

```rust
use log::Level;

// çº§åˆ«ä»é«˜ï¼ˆä¸¥é‡ï¼‰åˆ°ä½ï¼ˆè¯¦ç»†ï¼‰
Level::Error   // 1 - é”™è¯¯ï¼Œæœ€ä¸¥é‡
Level::Warn    // 2 - è­¦å‘Š
Level::Info    // 3 - ä¿¡æ¯
Level::Debug   // 4 - è°ƒè¯•
Level::Trace   // 5 - è¿½è¸ªï¼Œæœ€è¯¦ç»†
```

### çº§åˆ«æ¯”è¾ƒè§„åˆ™

```rust
// æ¯”è¾ƒè¿ç®—ç¬¦çš„å«ä¹‰ï¼š
// Error < Warn < Info < Debug < Trace

// ç¤ºä¾‹ï¼š
Level::Error < Level::Warn   // true (Error æ›´ä¸¥é‡ï¼Œæ•°å€¼æ›´å°)
Level::Info < Level::Debug   // true
Level::Debug > Level::Error  // true (Debug ä¸å¦‚ Error ä¸¥é‡)
```

## enabled æ–¹æ³•çš„å·¥ä½œåŸç†

### åœºæ™¯åˆ†æ

å‡è®¾æˆ‘ä»¬è®¾ç½®æ—¥å¿—çº§åˆ«ä¸º `Info`ï¼š

```rust
static LOGGER: TauriLogger = TauriLogger::new(LevelFilter::Info);
//                                             ^^^^^^^^^^^^^^^^
//                                             åªè®°å½• Info åŠä»¥ä¸Šçº§åˆ«
```

### åˆ¤æ–­é€»è¾‘

```rust
fn enabled(&self, metadata: &Metadata) -> bool {
    metadata.level() <= self.level
    //      ^^^^^^         ^^^^^^^^^^
    //      è¿™æ¡æ—¥å¿—çš„çº§åˆ«   é…ç½®çš„æœ€ä½çº§åˆ«
}
```

### å®é™…ä¾‹å­

```rust
// é…ç½®ï¼šåªè®°å½• Info åŠä»¥ä¸Š
// self.level = LevelFilter::Info

// åˆ¤æ–­ 1ï¼šError æ—¥å¿—
metadata.level() = Level::Error
Level::Error <= LevelFilter::Info  // true
// âœ… è®°å½•ï¼ˆError æ¯” Info æ›´é‡è¦ï¼‰

// åˆ¤æ–­ 2ï¼šWarn æ—¥å¿—
metadata.level() = Level::Warn
Level::Warn <= LevelFilter::Info  // true
// âœ… è®°å½•ï¼ˆWarn æ¯” Info æ›´é‡è¦ï¼‰

// åˆ¤æ–­ 3ï¼šInfo æ—¥å¿—
metadata.level() = Level::Info
Level::Info <= LevelFilter::Info  // true
// âœ… è®°å½•ï¼ˆæ°å¥½ç­‰äºè®¾ç½®çš„çº§åˆ«ï¼‰

// åˆ¤æ–­ 4ï¼šDebug æ—¥å¿—
metadata.level() = Level::Debug
Level::Debug <= LevelFilter::Info  // false
// âŒ ä¸è®°å½•ï¼ˆDebug æ¯” Info è¯¦ç»†ï¼Œè¢«è¿‡æ»¤ï¼‰

// åˆ¤æ–­ 5ï¼šTrace æ—¥å¿—
metadata.level() = Level::Trace
Level::Trace <= LevelFilter::Info  // false
// âŒ ä¸è®°å½•ï¼ˆTrace æœ€è¯¦ç»†ï¼Œè¢«è¿‡æ»¤ï¼‰
```

## å®Œæ•´çš„æ—¥å¿—å¤„ç†æµç¨‹

### 1. å†™æ—¥å¿—

```rust
fn main() {
    log::error!("Database connection failed");   // çº§åˆ«: Error
    log::warn!("Low memory warning");             // çº§åˆ«: Warn
    log::info!("User logged in");                 // çº§åˆ«: Info
    log::debug!("Processing request data");       // çº§åˆ«: Debug
    log::trace!("Function entry: process()");     // çº§åˆ«: Trace
}
```

### 2. è¿‡æ»¤æ—¥å¿—

```rust
impl log::Log for TauriLogger {
    fn enabled(&self, metadata: &Metadata) -> bool {
        // ç¬¬ä¸€é“è¿‡æ»¤ï¼šæ£€æŸ¥çº§åˆ«
        metadata.level() <= self.level
    }

    fn log(&self, record: &Record) {
        // ç¬¬äºŒé“è¿‡æ»¤ï¼šå†æ¬¡æ£€æŸ¥
        if !self.enabled(record.metadata()) {
            return;  // ä¸æ»¡è¶³çº§åˆ«è¦æ±‚ï¼Œç›´æ¥è¿”å›
        }
        
        // é€šè¿‡è¿‡æ»¤ï¼Œå¤„ç†æ—¥å¿—
        println!("{}", record.args());
    }
}
```

### 3. è¿è¡Œç»“æœï¼ˆé…ç½®ä¸º Infoï¼‰

```rust
// åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼Œè®¾ç½®çº§åˆ«ä¸º Info
static LOGGER: TauriLogger = TauriLogger::new(LevelFilter::Info);

fn main() {
    log::error!("Database connection failed");   // âœ… è¾“å‡º
    log::warn!("Low memory warning");             // âœ… è¾“å‡º
    log::info!("User logged in");                 // âœ… è¾“å‡º
    log::debug!("Processing request data");       // âŒ ä¸è¾“å‡ºï¼ˆè¢«è¿‡æ»¤ï¼‰
    log::trace!("Function entry: process()");     // âŒ ä¸è¾“å‡ºï¼ˆè¢«è¿‡æ»¤ï¼‰
}

// æ§åˆ¶å°è¾“å‡ºï¼š
// [12:34:56] ERROR - Database connection failed
// [12:34:56] WARN - Low memory warning
// [12:34:56] INFO - User logged in
```

## ä¸åŒçº§åˆ«çš„ä½¿ç”¨åœºæ™¯

### Error - é”™è¯¯

```rust
log::error!("Failed to connect to database: {}", err);
log::error!("Cannot read configuration file");
log::error!("Memory allocation failed");
```

**ä½•æ—¶ä½¿ç”¨ï¼š**
- âŒ ç¨‹åºå‡ºç°é”™è¯¯ï¼Œä½†å¯ä»¥ç»§ç»­è¿è¡Œ
- âŒ æ“ä½œå¤±è´¥
- âŒ ä¸¥é‡é—®é¢˜éœ€è¦ç«‹å³å…³æ³¨

### Warn - è­¦å‘Š

```rust
log::warn!("Disk space low: {}%", usage);
log::warn!("Deprecated API used");
log::warn!("Retry attempt {} of 3", attempt);
```

**ä½•æ—¶ä½¿ç”¨ï¼š**
- âš ï¸ æ½œåœ¨é—®é¢˜
- âš ï¸ ä¸æ¨èçš„åšæ³•
- âš ï¸ å¯èƒ½éœ€è¦å…³æ³¨çš„æƒ…å†µ

### Info - ä¿¡æ¯

```rust
log::info!("User {} logged in", username);
log::info!("Server started on port {}", port);
log::info!("Processing completed successfully");
```

**ä½•æ—¶ä½¿ç”¨ï¼š**
- â„¹ï¸ é‡è¦çš„ä¸šåŠ¡äº‹ä»¶
- â„¹ï¸ ç³»ç»ŸçŠ¶æ€å˜åŒ–
- â„¹ï¸ æ­£å¸¸çš„æ“ä½œæµç¨‹

### Debug - è°ƒè¯•

```rust
log::debug!("Processing request: {:?}", request);
log::debug!("Cache hit for key: {}", key);
log::debug!("Function calculate() took {}ms", duration);
```

**ä½•æ—¶ä½¿ç”¨ï¼š**
- ğŸ” å¼€å‘è°ƒè¯•
- ğŸ” è¯¦ç»†çš„æ‰§è¡Œæµç¨‹
- ğŸ” ä¸­é—´çŠ¶æ€å’Œå˜é‡å€¼

### Trace - è¿½è¸ª

```rust
log::trace!("Entering function: process_data()");
log::trace!("Loop iteration {}", i);
log::trace!("Variable x = {}", x);
```

**ä½•æ—¶ä½¿ç”¨ï¼š**
- ğŸ”¬ æœ€è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- ğŸ”¬ å‡½æ•°è¿›å…¥/é€€å‡º
- ğŸ”¬ æ¯ä¸€æ­¥çš„æ‰§è¡Œç»†èŠ‚

## çº§åˆ«é…ç½®å»ºè®®

### å¼€å‘ç¯å¢ƒ

```rust
// å¼€å‘æ—¶ï¼šä½¿ç”¨ Debug æˆ– Trace
static LOGGER: TauriLogger = TauriLogger::new(LevelFilter::Debug);
```

**åŸå› ï¼š**
- éœ€è¦è¯¦ç»†ä¿¡æ¯å¸®åŠ©è°ƒè¯•
- æ€§èƒ½ä¸æ˜¯ä¸»è¦å…³æ³¨ç‚¹
- èƒ½çœ‹åˆ°æ‰€æœ‰çš„æ‰§è¡Œç»†èŠ‚

### ç”Ÿäº§ç¯å¢ƒ

```rust
// ç”Ÿäº§æ—¶ï¼šä½¿ç”¨ Info æˆ– Warn
static LOGGER: TauriLogger = TauriLogger::new(LevelFilter::Info);
```

**åŸå› ï¼š**
- å‡å°‘æ—¥å¿—é‡ï¼Œæé«˜æ€§èƒ½
- åªè®°å½•é‡è¦ä¿¡æ¯
- é¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²

### æ•…éšœæ’æŸ¥

```rust
// æ’æŸ¥é—®é¢˜æ—¶ï¼šä¸´æ—¶æé«˜åˆ° Debug
static LOGGER: TauriLogger = TauriLogger::new(LevelFilter::Debug);
```

**åŸå› ï¼š**
- éœ€è¦æ›´å¤šç»†èŠ‚å®šä½é—®é¢˜
- é—®é¢˜è§£å†³åå†è°ƒå› Info

## æ€§èƒ½å½±å“

### ä¸ºä»€ä¹ˆéœ€è¦ enabled æ–¹æ³•ï¼Ÿ

```rust
// âŒ å¦‚æœæ²¡æœ‰ enabled æ£€æŸ¥
fn log(&self, record: &Record) {
    // å³ä½¿ä¸è¾“å‡ºï¼Œä¹Ÿè¦æ ¼å¼åŒ–å­—ç¬¦ä¸²
    let msg = format!("User {} logged in at {}", user, time);
    // å¾ˆæµªè´¹ï¼
}

// âœ… æœ‰äº† enabled æ£€æŸ¥
fn log(&self, record: &Record) {
    if !self.enabled(record.metadata()) {
        return;  // ç›´æ¥è¿”å›ï¼Œä¸åšä»»ä½•å¤„ç†
    }
    // åªæœ‰é€šè¿‡è¿‡æ»¤çš„æ‰å¤„ç†
    let msg = format!("User {} logged in at {}", user, time);
}
```

### æ€§èƒ½ä¼˜åŒ–

```rust
// æ–¹å¼ 1ï¼šç›´æ¥è°ƒç”¨ï¼ˆæ€»æ˜¯ä¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰
log::debug!("Value: {}", expensive_calculation());
// å³ä½¿ Debug çº§åˆ«è¢«è¿‡æ»¤ï¼Œexpensive_calculation() ä»ä¼šæ‰§è¡Œï¼

// æ–¹å¼ 2ï¼šæ‰‹åŠ¨æ£€æŸ¥ï¼ˆæ¨èï¼‰
if log::log_enabled!(log::Level::Debug) {
    log::debug!("Value: {}", expensive_calculation());
    // åªæœ‰ Debug çº§åˆ«å¯ç”¨æ—¶æ‰æ‰§è¡Œ
}

// æ–¹å¼ 3ï¼šä½¿ç”¨é—­åŒ…
log::debug!(target: "my_target", "Value: {}", {
    expensive_calculation()
});
```

## å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæ ¹æ®ç¯å¢ƒè®¾ç½®çº§åˆ«

```rust
pub fn init_logger(app_handle: AppHandle) {
    // æ ¹æ®ç¼–è¯‘æ¨¡å¼è®¾ç½®ä¸åŒçº§åˆ«
    #[cfg(debug_assertions)]
    let level = LevelFilter::Debug;  // å¼€å‘æ¨¡å¼
    
    #[cfg(not(debug_assertions))]
    let level = LevelFilter::Info;   // ç”Ÿäº§æ¨¡å¼
    
    // åˆå§‹åŒ– logger
    // ...
}
```

### ç¤ºä¾‹ 2ï¼šåŠ¨æ€è°ƒæ•´çº§åˆ«

```rust
use std::sync::atomic::{AtomicU8, Ordering};

pub struct TauriLogger {
    app_handle: OnceLock<AppHandle>,
    level: AtomicU8,  // å¯ä»¥åŠ¨æ€ä¿®æ”¹
}

impl TauriLogger {
    pub fn set_level(&self, level: LevelFilter) {
        self.level.store(level as u8, Ordering::Relaxed);
    }
    
    pub fn get_level(&self) -> LevelFilter {
        unsafe { std::mem::transmute(self.level.load(Ordering::Relaxed)) }
    }
}

impl log::Log for TauriLogger {
    fn enabled(&self, metadata: &Metadata) -> bool {
        metadata.level() <= self.get_level()
    }
}

// ä½¿ç”¨
#[tauri::command]
fn set_log_level(level: String) {
    let level = match level.as_str() {
        "error" => LevelFilter::Error,
        "warn" => LevelFilter::Warn,
        "info" => LevelFilter::Info,
        "debug" => LevelFilter::Debug,
        "trace" => LevelFilter::Trace,
        _ => LevelFilter::Info,
    };
    LOGGER.set_level(level);
}
```

### ç¤ºä¾‹ 3ï¼šæŒ‰æ¨¡å—è¿‡æ»¤

```rust
impl log::Log for TauriLogger {
    fn enabled(&self, metadata: &Metadata) -> bool {
        // åŸºæœ¬çº§åˆ«æ£€æŸ¥
        if metadata.level() > self.level {
            return false;
        }
        
        // ç‰¹æ®Šæ¨¡å—çš„é¢å¤–è¿‡æ»¤
        let target = metadata.target();
        
        // æŸäº›æ¨¡å—åªè®°å½• Warn ä»¥ä¸Š
        if target.starts_with("noisy_module") {
            return metadata.level() <= Level::Warn;
        }
        
        // æŸäº›æ¨¡å—è®°å½•æ‰€æœ‰çº§åˆ«
        if target.starts_with("important_module") {
            return true;
        }
        
        true
    }
}
```

## æ€»ç»“

### enabled æ–¹æ³•çš„ä½œç”¨

```rust
fn enabled(&self, metadata: &Metadata) -> bool {
    metadata.level() <= self.level
}
```

1. **åˆ¤æ–­æ—¥å¿—æ˜¯å¦åº”è¯¥è®°å½•**
   - `<=` è¡¨ç¤º"ä¸æ¯”é…ç½®çº§åˆ«æ›´è¯¦ç»†"
   - è¿”å› `true` â†’ è®°å½•è¿™æ¡æ—¥å¿—
   - è¿”å› `false` â†’ å¿½ç•¥è¿™æ¡æ—¥å¿—

2. **æ€§èƒ½ä¼˜åŒ–**
   - æå‰è¿‡æ»¤ï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†
   - å‡å°‘å­—ç¬¦ä¸²æ ¼å¼åŒ–å¼€é”€
   - å‡å°‘ IO æ“ä½œ

3. **çµæ´»æ§åˆ¶**
   - ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçº§åˆ«
   - å¯ä»¥åŠ¨æ€è°ƒæ•´
   - å¯ä»¥æŒ‰æ¨¡å—è¿‡æ»¤

### çº§åˆ«é€‰æ‹©æŒ‡å—

| çº§åˆ« | åŒ…å«çš„æ—¥å¿— | é€‚ç”¨åœºæ™¯ |
|------|-----------|---------|
| **Error** | Error | ç”Ÿäº§ç¯å¢ƒï¼ˆåªè®°å½•é”™è¯¯ï¼‰ |
| **Warn** | Error + Warn | ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰ |
| **Info** | Error + Warn + Info | ç”Ÿäº§ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰ |
| **Debug** | Error + Warn + Info + Debug | å¼€å‘ç¯å¢ƒï¼ˆæ¨èï¼‰ |
| **Trace** | æ‰€æœ‰çº§åˆ« | æ·±åº¦è°ƒè¯• |

### è®°å¿†æŠ€å·§

```
è®¾ç½®çº§åˆ« Infoï¼š
âœ… Error  ï¼ˆæ¯” Info é‡è¦ï¼‰
âœ… Warn   ï¼ˆæ¯” Info é‡è¦ï¼‰
âœ… Info   ï¼ˆç­‰äº Infoï¼‰
âŒ Debug  ï¼ˆæ¯” Info è¯¦ç»†ï¼Œè¢«è¿‡æ»¤ï¼‰
âŒ Trace  ï¼ˆæ¯” Info è¯¦ç»†ï¼Œè¢«è¿‡æ»¤ï¼‰

è§„åˆ™ï¼šåªè®°å½•"ä¸æ¯”è®¾ç½®çº§åˆ«æ›´è¯¦ç»†"çš„æ—¥å¿—
```

è¿™å°±æ˜¯ `enabled` æ–¹æ³•çš„å®Œæ•´å«ä¹‰ï¼å®ƒæ˜¯æ—¥å¿—ç³»ç»Ÿçš„å®ˆé—¨å‘˜ï¼Œå†³å®šå“ªäº›æ—¥å¿—å¯ä»¥é€šè¿‡ã€‚ğŸšª

