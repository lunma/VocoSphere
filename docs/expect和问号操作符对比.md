# âš ï¸ expect vs ? æ“ä½œç¬¦è¯¦è§£

## ğŸ¯ æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | `expect()` | `?` æ“ä½œç¬¦ |
|------|-----------|-----------|
| **é‡åˆ°é”™è¯¯** | **panicï¼ˆç¨‹åºå´©æºƒï¼‰** | **è¿”å›é”™è¯¯ï¼ˆç»§ç»­è¿è¡Œï¼‰** |
| **é€‚ç”¨åœºæ™¯** | ä¸åº”è¯¥å¤±è´¥çš„æ“ä½œ | å¯èƒ½å¤±è´¥çš„æ“ä½œ |
| **é”™è¯¯ä¼ æ’­** | âŒ ä¸ä¼ æ’­ | âœ… ä¼ æ’­ç»™è°ƒç”¨è€… |
| **æ¢å¤å¯èƒ½** | âŒ æ— æ³•æ¢å¤ | âœ… è°ƒç”¨è€…å¯å¤„ç† |
| **ç”Ÿäº§ç¯å¢ƒ** | âš ï¸ è°¨æ…ä½¿ç”¨ | âœ… æ¨èä½¿ç”¨ |

## ğŸ“ è¯¦ç»†å¯¹æ¯”

### expect() - é‡åˆ°é”™è¯¯å°±å´©æºƒ

```rust
fn process() {
    // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç¨‹åºå´©æºƒ ğŸ’¥
    let content = std::fs::read_to_string("config.txt")
        .expect("æ— æ³•è¯»å–é…ç½®æ–‡ä»¶");
    
    println!("å†…å®¹: {}", content);
    // å¦‚æœä¸Šé¢å¤±è´¥ï¼Œè¿™è¡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ
}

// é”™è¯¯è¾“å‡ºï¼š
// thread 'main' panicked at 'æ— æ³•è¯»å–é…ç½®æ–‡ä»¶: No such file or directory'
// ç¨‹åºç»ˆæ­¢ âŒ
```

### ? æ“ä½œç¬¦ - é‡åˆ°é”™è¯¯å°±è¿”å›

```rust
fn process() -> Result<(), std::io::Error> {
    // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»™è°ƒç”¨è€… â†©ï¸
    let content = std::fs::read_to_string("config.txt")?;
    
    println!("å†…å®¹: {}", content);
    Ok(())
}

fn main() {
    match process() {
        Ok(_) => println!("æˆåŠŸ"),
        Err(e) => println!("å¤„ç†å¤±è´¥: {}", e),  // å¯ä»¥å¤„ç†é”™è¯¯
    }
    // ç¨‹åºç»§ç»­è¿è¡Œ âœ…
}
```

## ğŸ” è¯¦ç»†è¡Œä¸º

### expect() çš„è¡Œä¸º

```rust
// expect() çš„ç­‰ä»·å®ç°
match result {
    Ok(value) => value,           // æˆåŠŸï¼šè¿”å›å€¼
    Err(e) => panic!("{}: {}", message, e),  // å¤±è´¥ï¼španic! ğŸ’¥
}
```

**ç¤ºä¾‹**ï¼š
```rust
let num = "abc".parse::<i32>()
    .expect("è§£æå¤±è´¥");
// è¾“å‡ºï¼š
// thread 'main' panicked at 'è§£æå¤±è´¥: invalid digit found in string'
// ç¨‹åºå´©æºƒ âŒ
```

### ? çš„è¡Œä¸º

```rust
// ? çš„ç­‰ä»·å®ç°
match result {
    Ok(value) => value,           // æˆåŠŸï¼šè¿”å›å€¼
    Err(e) => return Err(e.into()),  // å¤±è´¥ï¼šè¿”å›é”™è¯¯ â†©ï¸
}
```

**ç¤ºä¾‹**ï¼š
```rust
fn parse_number(s: &str) -> Result<i32, std::num::ParseIntError> {
    let num = s.parse::<i32>()?;  // å¤±è´¥æ—¶è¿”å›é”™è¯¯
    Ok(num)
}

fn main() {
    match parse_number("abc") {
        Ok(n) => println!("æ•°å­—: {}", n),
        Err(e) => println!("è§£æå¤±è´¥: {}", e),  // å¯ä»¥å¤„ç†
    }
    // ç¨‹åºç»§ç»­è¿è¡Œ âœ…
}
```

## ğŸ’¡ åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­çš„ä¾‹å­

### âŒ ä¸å¥½çš„ç”¨æ³•ï¼ˆexpectï¼‰

```rust
// æˆ‘ä»¬ä¹‹å‰çš„ä»£ç 
let device = audio::find_loopback_device()
    .expect("æ‰¾ä¸åˆ°ç¯å›è®¾å¤‡");  // âŒ æ‰¾ä¸åˆ°è®¾å¤‡å°±å´©æºƒ

let stream = device.build_input_stream(...)
    .expect("æ— æ³•åˆ›å»ºæµ");  // âŒ åˆ›å»ºå¤±è´¥å°±å´©æºƒ

stream.play()
    .expect("æ— æ³•æ’­æ”¾");  // âŒ æ’­æ”¾å¤±è´¥å°±å´©æºƒ
```

**é—®é¢˜**ï¼š
- ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ ç¨‹åºå´©æºƒ â†’ æ•´ä¸ªåº”ç”¨å…³é—­ ğŸ’¥
- æ— æ³•ç»™ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- æ— æ³•æ¢å¤

### âœ… å¥½çš„ç”¨æ³•ï¼ˆ?ï¼‰

```rust
// ä¼˜åŒ–åçš„ä»£ç 
async fn run_audio_capture() -> anyhow::Result<()> {
    let device = audio::find_loopback_device()
        .context("æ‰¾ä¸åˆ°ç¯å›è®¾å¤‡")?;  // âœ… è¿”å›é”™è¯¯
    
    let stream = device.build_input_stream(...)?;  // âœ… è¿”å›é”™è¯¯
    
    stream.play()?;  // âœ… è¿”å›é”™è¯¯
    
    Ok(())
}

// è°ƒç”¨å¤„
tokio::spawn(async move {
    match run_audio_capture().await {
        Ok(_) => info!("æ­£å¸¸ç»“æŸ"),
        Err(e) => warn!("é”™è¯¯: {}", e),  // âœ… å¯ä»¥å¤„ç†é”™è¯¯
    }
});
```

**ä¼˜ç‚¹**ï¼š
- é”™è¯¯è¢«æ•è·å¹¶è®°å½•
- åº”ç”¨ç»§ç»­è¿è¡Œ âœ…
- å¯ä»¥ç»™ç”¨æˆ·å‹å¥½æç¤º

## ğŸ“ ä½¿ç”¨æŒ‡å—

### ä»€ä¹ˆæ—¶å€™ç”¨ expect()ï¼Ÿ

**åªåœ¨ç¡®ä¿¡ä¸ä¼šå¤±è´¥çš„æƒ…å†µ**ï¼š

```rust
// âœ… åˆç†ä½¿ç”¨ expect
let mutex = Arc::new(Mutex::new(0));
let guard = mutex.lock().expect("Mutex è¢«æ±¡æŸ“");  
// Mutex å¾ˆå°‘ä¼šè¢«æ±¡æŸ“ï¼Œå¦‚æœæ±¡æŸ“è¯´æ˜ä»£ç æœ‰ä¸¥é‡é—®é¢˜

// âœ… åˆç†ä½¿ç”¨ expect
let env_var = std::env::var("å¿…éœ€çš„ç¯å¢ƒå˜é‡")
    .expect("ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œç¨‹åºæ— æ³•è¿è¡Œ");
// å¦‚æœå¿…éœ€çš„ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œå´©æºƒæ˜¯åˆç†çš„
```

### ä»€ä¹ˆæ—¶å€™ç”¨ ?

**æ‰€æœ‰å¯èƒ½å¤±è´¥çš„æ“ä½œ**ï¼š

```rust
// âœ… æ¨èä½¿ç”¨ ?
fn process() -> Result<()> {
    let file = std::fs::read_to_string(path)?;  // æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨
    let data = serde_json::from_str(&file)?;    // è§£æå¯èƒ½å¤±è´¥
    let connection = connect_server()?;         // è¿æ¥å¯èƒ½å¤±è´¥
    Ok(())
}
```

## ğŸ“Š å®é™…åœºæ™¯å¯¹æ¯”

### åœºæ™¯ 1ï¼šæ‰“å¼€æ–‡ä»¶

```rust
// âŒ ä¸æ¨èï¼ˆç¨‹åºä¼šå´©æºƒï¼‰
let file = std::fs::File::open("data.txt")
    .expect("æ— æ³•æ‰“å¼€æ–‡ä»¶");

// âœ… æ¨èï¼ˆè¿”å›é”™è¯¯ï¼‰
let file = std::fs::File::open("data.txt")?;
```

### åœºæ™¯ 2ï¼šç½‘ç»œè¿æ¥

```rust
// âŒ ä¸æ¨èï¼ˆç½‘ç»œæ–­å¼€å°±å´©æºƒï¼‰
let response = reqwest::get(url).await
    .expect("è¯·æ±‚å¤±è´¥");

// âœ… æ¨èï¼ˆå¯ä»¥é‡è¯•ï¼‰
let response = reqwest::get(url).await?;
```

### åœºæ™¯ 3ï¼šç”¨æˆ·è¾“å…¥

```rust
// âŒ æå…¶ä¸æ¨èï¼ˆç”¨æˆ·è¾“å…¥é”™è¯¯å°±å´©æºƒï¼‰
let number = user_input.parse::<i32>()
    .expect("è¾“å…¥å¿…é¡»æ˜¯æ•°å­—");

// âœ… æ¨èï¼ˆæ˜¾ç¤ºé”™è¯¯æç¤ºï¼‰
let number = user_input.parse::<i32>()
    .map_err(|_| "è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—")?;
```

## ğŸ”§ æˆ‘ä»¬é¡¹ç›®ä¸­çš„æ”¹è¿›

### æ”¹è¿›å‰ï¼ˆä½¿ç”¨ expectï¼‰

```rust
let device = audio::find_loopback_device()
    .expect("æ‰¾ä¸åˆ°ç¯å›è®¾å¤‡");  // ğŸ’¥ å´©æºƒ

let stream = device.build_input_stream(...)
    .expect("æ— æ³•åˆ›å»ºæµ");  // ğŸ’¥ å´©æºƒ

stream.play()
    .expect("æ— æ³•æ’­æ”¾");  // ğŸ’¥ å´©æºƒ
```

**é—®é¢˜**ï¼š
- ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ æ‰¾ä¸åˆ°è®¾å¤‡ â†’ **æ•´ä¸ª Tauri åº”ç”¨å´©æºƒå…³é—­** ğŸ’¥

### æ”¹è¿›åï¼ˆä½¿ç”¨ ?ï¼‰

```rust
async fn run_audio_capture() -> anyhow::Result<()> {
    let device = audio::find_loopback_device()
        .context("æ‰¾ä¸åˆ°ç¯å›è®¾å¤‡")?;  // âœ… è¿”å›é”™è¯¯
    
    let stream = device.build_input_stream(...)?;  // âœ… è¿”å›é”™è¯¯
    
    stream.play()?;  // âœ… è¿”å›é”™è¯¯
    
    Ok(())
}

// åœ¨ start_audio_capture ä¸­å¤„ç†é”™è¯¯
tokio::spawn(async move {
    match run_audio_capture().await {
        Ok(_) => info!("æ­£å¸¸ç»“æŸ"),
        Err(e) => {
            warn!("éŸ³é¢‘æ•è·é”™è¯¯: {}", e);
            IS_RECORDING.store(false, Ordering::SeqCst);
            // âœ… åº”ç”¨ç»§ç»­è¿è¡Œï¼Œåªæ˜¯è¿™ä¸ªåŠŸèƒ½å¤±è´¥äº†
        }
    }
});
```

**ä¼˜ç‚¹**ï¼š
- ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ æ‰¾ä¸åˆ°è®¾å¤‡ â†’ **æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯** â†’ åº”ç”¨æ­£å¸¸è¿è¡Œ âœ…
- å¯ä»¥ç»™ç”¨æˆ·å‹å¥½æç¤º
- ä¸å½±å“åº”ç”¨å…¶ä»–åŠŸèƒ½

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### expect()
```rust
let value = operation().expect("é”™è¯¯æ¶ˆæ¯");
// æˆåŠŸ â†’ è¿”å› value
// å¤±è´¥ â†’ panic!("é”™è¯¯æ¶ˆæ¯") ğŸ’¥ ç¨‹åºå´©æºƒ
```

### ?
```rust
fn process() -> Result<T, E> {
    let value = operation()?;
    // æˆåŠŸ â†’ ç»§ç»­æ‰§è¡Œï¼Œvalue å¯ç”¨
    // å¤±è´¥ â†’ return Err(error) â†©ï¸ è¿”å›ç»™è°ƒç”¨è€…
    Ok(value)
}
```

### unwrap()ï¼ˆæœ€å±é™©ï¼Œä¸æ¨èï¼‰
```rust
let value = operation().unwrap();
// æˆåŠŸ â†’ è¿”å› value
// å¤±è´¥ â†’ panic!() ğŸ’¥ æ²¡æœ‰é”™è¯¯æ¶ˆæ¯
```

## ğŸ¯ æ¨èå®è·µ

### åº”ç”¨ç¨‹åºä»£ç 

```rust
// âœ… æ¨èï¼šå‡ ä¹æ€»æ˜¯ç”¨ ?
async fn run_audio_capture() -> Result<()> {
    let device = find_device()?;
    let stream = create_stream()?;
    stream.play()?;
    Ok(())
}
```

### åªåœ¨è¿™äº›æƒ…å†µç”¨ expect

1. **Mutex æ±¡æŸ“**ï¼ˆæå°‘å‘ç”Ÿï¼‰
   ```rust
   let guard = mutex.lock().expect("Mutex æ±¡æŸ“");
   ```

2. **å¿…éœ€çš„åˆå§‹åŒ–**ï¼ˆç¨‹åºæ— æ³•è¿è¡Œï¼‰
   ```rust
   let config = load_config().expect("é…ç½®æ–‡ä»¶å¿…é¡»å­˜åœ¨");
   ```

3. **é€»è¾‘ä¸Šä¸å¯èƒ½å¤±è´¥**
   ```rust
   let num = "123".parse::<i32>().expect("ç¡¬ç¼–ç çš„æ•°å­—ä¸å¯èƒ½å¤±è´¥");
   ```

---

## ğŸ“š æ€»ç»“

| æ–¹æ³• | é”™è¯¯å¤„ç† | ç¨‹åºè¡Œä¸º | ä½¿ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| **`expect(msg)`** | panic å¹¶æ˜¾ç¤ºæ¶ˆæ¯ | å´©æºƒ ğŸ’¥ | ä¸åº”è¯¥å¤±è´¥çš„æ“ä½œ |
| **`?`** | è¿”å›é”™è¯¯ | ç»§ç»­è¿è¡Œ âœ… | å¯èƒ½å¤±è´¥çš„æ“ä½œï¼ˆæ¨èï¼‰|
| **`unwrap()`** | panic æ— æ¶ˆæ¯ | å´©æºƒ ğŸ’¥ | âŒ ä¸æ¨èä½¿ç”¨ |

**ä¸€å¥è¯æ€»ç»“**ï¼š
> **`expect()` = å´©æºƒå¹¶æ˜¾ç¤ºæ¶ˆæ¯**  
> **`?` = è¿”å›é”™è¯¯ç»§ç»­è¿è¡Œ**  
> **ç”Ÿäº§ä»£ç æ¨èç”¨ `?`**

**å·²åˆ›å»ºæ–‡æ¡£**ï¼š[docs/anyhowé”™è¯¯å¤„ç†è¯¦è§£.md](docs/anyhowé”™è¯¯å¤„ç†è¯¦è§£.md) ğŸ“š
